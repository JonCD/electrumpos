{% extends "base.html" %}
{% load i18n %}
{% load currency_conversions %}
{% load bootstrap_toolkit %}
{% block content %}

<div class="row">
  <div class="span8"><h1>{% if merchant.business_name %}{{ merchant.business_name }}{% else %}{{ merchant.business_name }}{% endif %}</h1>


  </div>

<div class="well" style="float: right;">1 BTC = {{ 1|btc2currency:merchant.currency }} {{ merchant.currency }}</div>
</div>


{% if payment %}
    <h2>Payment #{{payment.id}}</h2>
<center>
<div class="well">
    {{ payment.currency_amount }} {{ merchant.currency }} = {{ payment.btc_amount }} BTC<br/>
    Exchange rate: {{ payment.exchange_rate }} (24h avg)<br/>
    {{ payment.bitcoin_address }}<br/>
    <img src="/django_bitcoin/qrcode/{{ payment.payment_url }}"/>
</div>
</center>
{% endif %}

<h2>New payment/address</h2>

<form id="paymentform" action="{{ merchant.url }}" method="POST">{% csrf_token %}
    {{ payment_form }} {{ merchant.currency }}<br/>
    <button type="submit" name="submit" class="btn btn-danger">{% trans "New payment" %}</button>
</form>

<h2>Old payments</h2>

<table id="payments" class="table table-striped">
<tr>
    <th>Status</th>
    <th>Date</th>
    <th>Bitcoin address</th>
    <th>Requested amount</th>
    <th>Received</th>
</tr>

{% for p in previous_payments %}
<tr class="payment">
    <td>{% if p.is_paid %}
    <span class="label label-success">Paid</span>
{% else %}
    <span class="label label-warning">Unpaid</span>
{% endif %}</td>
    <td>{{ p.created_at }}</td>
    <td class="address"><a href="/m/{{ merchant.uuid }}/{{ p.id }}">{{ p.bitcoin_address }}</a></td>
    <td class="amount" data-amount="{{ p.btc_amount }}">{{ p.btc_amount }} BTC ({{ p.currency_amount }} {{ merchant.currency }})</td>
    <td>{{ p.received|btc2currency:"BTC" }}</td>
</tr>
{% endfor %}
</table>

<div class="well">

    <h4>Merchant information</h4>

    <b>Master public key:</b> {{ merchant.master_public_key|truncatechars:10 }}<br/>
    <b>Payments URL:</b> {{ merchant.url }}<br/>

</div>

<h3>Tips</h3>

<ul>
<li>You can use the same URL with multiple devices, and also share it with your employees, friends and family.</li>
</ul>

{% endblock content %}

{% block scripts %}
    <script src="/static/js/socket.io.min.js"></script>
    <script src="/static/js/bitcoinjs-exit.js"></script>
    <script src="/static/js/payment.js"></script>
{% endblock scripts %}
